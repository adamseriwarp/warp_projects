<!DOCTYPE html>
<html>
<head>
    <title>WARP CBSA Market Expansion Analysis - Demo</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        #map { height: 100vh; width: 100vw; }
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            min-width: 320px;
            max-width: 380px;
            max-height: calc(100vh - 60px);
            overflow-y: auto;
            font-size: 14px;
        }
        .controls h4 { margin: 0 0 15px 0; color: #333; }
        .slider-container {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #007cba;
        }
        .slider-container label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #495057;
        }
        .slider-wrapper {
            position: relative;
            margin: 10px 0;
        }
        #distanceSlider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #ff6b6b, #feca57, #48dbfb, #0abde3);
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }
        #distanceSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #007cba;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .distance-display {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            color: #007cba;
            margin: 10px 0;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        .range-labels {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #666;
            margin-top: 5px;
        }
        .checkbox-container {
            margin: 12px 0;
            padding: 8px;
            background: #e9ecef;
            border-radius: 5px;
        }
        .checkbox-container input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.2);
        }
        .checkbox-container label {
            font-weight: normal;
            margin: 0;
            cursor: pointer;
        }
        .stats {
            font-size: 11px;
            color: #495057;
            margin-top: 10px;
            padding: 10px;
            background: #f1f3f4;
            border-radius: 6px;
            border-left: 4px solid #007cba;
            line-height: 1.3;
        }
        .legend {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 350px;
            font-size: 12px;
        }
        .color-scale {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        .color-box {
            width: 20px;
            height: 15px;
            margin-right: 8px;
            border: 1px solid #333;
        }
        .improvement-badge {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
        }
        .demo-notice {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #856404;
        }
        .demo-notice h5 {
            margin: 0 0 10px 0;
            color: #856404;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <div class="controls">
        <h4>üé® <span class="improvement-badge">DEMO</span> CBSA Analysis</h4>
        
        <div class="demo-notice">
            <h5>üìã Demo Version</h5>
            <p>This is a demonstration version with sample data. The full version analyzes 33,925+ zip codes with real quote data.</p>
        </div>

        <div class="slider-container">
            <label for="distanceSlider">Distance to Nearest CBSA Coverage:</label>
            <div class="slider-wrapper">
                <input type="range" id="distanceSlider" min="5" max="200" value="50" step="5">
            </div>
            <div class="distance-display" id="distanceDisplay">50 miles</div>
            <div class="range-labels">
                <span>5 miles</span>
                <span>200 miles</span>
            </div>
        </div>

        <div class="checkbox-container">
            <input type="checkbox" id="showAllCBSA" checked>
            <label for="showAllCBSA">Show all CBSA zip codes</label>
        </div>

        <div class="checkbox-container">
            <input type="checkbox" id="showNearbyNonCBSA" checked>
            <label for="showNearbyNonCBSA">Show nearby non-CBSA zip codes</label>
        </div>

        <div class="checkbox-container">
            <input type="checkbox" id="showCentroids" checked>
            <label for="showCentroids">Show CBSA weighted centroids</label>
        </div>

        <div class="checkbox-container">
            <input type="checkbox" id="showCrossdocks" checked>
            <label for="showCrossdocks">Show crossdock locations</label>
        </div>

        <div style="background: #e3f2fd; padding: 8px; border-radius: 4px; font-size: 12px; margin: 10px 0;">
            <strong>üé® COLOR-CODED Features:</strong><br>
            ‚úÖ Each CBSA has a unique color for easy distinction<br>
            ‚úÖ No quote density heat mapping - cleaner visualization<br>
            ‚úÖ Red color for non-CBSA zip codes<br>
            ‚úÖ All other functionality preserved
        </div>

        <div class="stats" id="filterStats">
            <strong>Demo Data Loaded:</strong><br>
            üé® CBSA zip codes: 1<br>
            üî¥ Non-CBSA zip codes: 1<br>
            üéØ CBSA centroids: 1<br>
            üè≠ Crossdocks: 1<br>
            üìç Total displayed: 2
        </div>
    </div>

    <div class="legend">
        <h4>üé® WARP CBSA Color-Coded Map</h4>
        <div><strong>CBSA-Assigned:</strong></div>
        <div class="color-scale">
            <div class="color-box" style="background: #4ecdc4;"></div>
            <div class="color-box" style="background: #45b7d1;"></div>
            <div class="color-box" style="background: #f9ca24;"></div>
            <div class="color-box" style="background: #6c5ce7;"></div>
            <div class="color-box" style="background: #26de81;"></div>
            <span>Each CBSA has a unique color (no red)</span>
        </div>
        <div style="margin-top: 10px;"><strong>Non-CBSA:</strong></div>
        <div class="color-scale">
            <div class="color-box" style="background: #FF4444;"></div>
            <span>Red for all non-CBSA zip codes</span>
        </div>
        <div style="margin-top: 8px; font-size: 10px; color: #666; font-style: italic;">
            üéØ Red circles = CBSA weighted centroids<br>
            üè≠ Green diamonds = Crossdock locations<br>
            üìè Distances calculated to nearest CBSA zip codes
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize map
        var map = L.map('map').setView([34.0522, -118.2437], 8);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // Sample data for demonstration
        var sampleZipData = [
            {
                "type": "Feature",
                "properties": {
                    "zipcode_clean": "90210",
                    "city": "Beverly Hills",
                    "state": "CA",
                    "cbsa_name": "Los Angeles-Long Beach-Anaheim, CA",
                    "total_quotes": 150,
                    "population": 32701,
                    "has_cbsa": true,
                    "cbsa_color": "#4ecdc4",
                    "distance_to_cbsa": 0,
                    "std_dev_from_cbsa_mean": 0.5
                },
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [[[-118.4, 34.1], [-118.35, 34.1], [-118.35, 34.05], [-118.4, 34.05], [-118.4, 34.1]]]
                }
            },
            {
                "type": "Feature", 
                "properties": {
                    "zipcode_clean": "93001",
                    "city": "Ventura",
                    "state": "CA",
                    "cbsa_name": null,
                    "total_quotes": 45,
                    "population": 28592,
                    "has_cbsa": false,
                    "cbsa_color": "#FF4444",
                    "distance_to_cbsa": 25.5,
                    "std_dev_from_cbsa_mean": -1.2
                },
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [[[-119.3, 34.3], [-119.25, 34.3], [-119.25, 34.25], [-119.3, 34.25], [-119.3, 34.3]]]
                }
            }
        ];

        var sampleCbsaCentroids = [
            {
                "cbsa_name": "Los Angeles-Long Beach-Anaheim, CA",
                "lat": 34.0522,
                "lon": -118.2437,
                "total_quotes": 15000,
                "zip_count": 150
            }
        ];

        var sampleCrossdocks = [
            {
                "zip_code": "90021",
                "name": "LAX Crossdock",
                "lat": 34.0291,
                "lon": -118.2389
            }
        ];

        // Display sample data
        sampleZipData.forEach(function(zipData) {
            var layer = L.geoJSON(zipData, {
                style: {
                    fillColor: zipData.properties.cbsa_color,
                    color: zipData.properties.has_cbsa ? '#333333' : '#666666',
                    weight: 2,
                    opacity: 0.8,
                    fillOpacity: 0.7
                },
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(`
                        <strong>${feature.properties.zipcode_clean}</strong><br>
                        <strong>City:</strong> ${feature.properties.city}<br>
                        <strong>State:</strong> ${feature.properties.state}<br>
                        <strong>Total Quotes:</strong> ${feature.properties.total_quotes}<br>
                        <strong>Population:</strong> ${feature.properties.population.toLocaleString()}<br>
                        <strong>CBSA:</strong> ${feature.properties.cbsa_name || 'Non-CBSA'}<br>
                        ${!feature.properties.has_cbsa ?
                            `<strong>Distance to CBSA:</strong> ${feature.properties.distance_to_cbsa} miles<br>
                             <strong>Performance vs CBSA:</strong> ${feature.properties.std_dev_from_cbsa_mean} std dev<br>` : ''}
                    `);
                }
            }).addTo(map);
        });

        // Add CBSA centroids
        sampleCbsaCentroids.forEach(function(centroid) {
            var marker = L.circleMarker([centroid.lat, centroid.lon], {
                radius: 10,
                fillColor: '#d62728',
                color: '#ffffff',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(map);

            marker.bindPopup(`
                <strong>üéØ ${centroid.cbsa_name}</strong><br>
                <strong>Total Quotes:</strong> ${centroid.total_quotes.toLocaleString()}<br>
                <strong>Zip Codes:</strong> ${centroid.zip_count}<br>
                <em>Quote-weighted business center</em>
            `);
        });

        // Add crossdocks
        sampleCrossdocks.forEach(function(crossdock) {
            var marker = L.marker([crossdock.lat, crossdock.lon], {
                icon: L.divIcon({
                    className: 'crossdock-icon',
                    html: 'üè≠',
                    iconSize: [20, 20],
                    iconAnchor: [10, 10]
                })
            }).addTo(map);

            marker.bindPopup(`
                <strong>üè≠ ${crossdock.name}</strong><br>
                <strong>Zip Code:</strong> ${crossdock.zip_code}<br>
                <em>Crossdock facility</em>
            `);
        });

        // Interactive controls
        document.getElementById('distanceSlider').addEventListener('input', function() {
            document.getElementById('distanceDisplay').textContent = this.value + ' miles';
        });
    </script>
</body>
</html>
